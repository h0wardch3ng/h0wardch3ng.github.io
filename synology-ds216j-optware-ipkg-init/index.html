<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <script>var url=window.location.href;url.indexOf("https")<0&&(url=url.replace("http:","https:"),window.location.replace(url));</script>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    
    <title>Synology DS216j Optware IPKG 介紹 - Siege</title>
    
    <meta name="description" content="Wherever we want to go, we go.">
    <meta name="author" content="h0wardch3ng">
    
    <link href="https://via.moe/an-old-hope.min.css" rel="stylesheet">
    <link href="https://via.moe/style.css" rel="stylesheet">
    <link href="https://via.moe/custom.css" rel="stylesheet">
    
    <link rel="apple-touch-icon" href="https://via.moe/apple-touch-icon.png">
    <link rel="icon" href="https://via.moe/favicon.ico">
    <meta name="generator" content="Hugo 0.82.0" />
    
    
  </head>
  <body class="single">
    <header class="header">
      <nav class="nav">
        <p class="logo"><a href="https://via.moe/">Siege</a></p>
        <ul class="menu">
          <li>
            <a href="/">Index</a>
          </li>
          <li>
            <a href="/rss.xml">RSS</a>
          </li>
          <li>
            <a href="/about/">About</a>
          </li>
        </ul>
      </nav>
    </header>
    <main class="main">


<article class="post-single">
  <header class="post-header">
    <h1 class="post-title">Synology DS216j Optware IPKG 介紹</h1>
    <div class="post-meta">September 5, 2016</div>
  </header>
  <div class="post-content"><p>本文原有内容已經可能不可用，目前可以使用第三方源内的 GUI 工具安裝 Bootstrap</p>
<pre><code>http://packages.synocommunity.net
http://www.cphub.net
</code></pre><p><img src="https://chattim.files.wordpress.com/2016/05/easybootstrapinstaller.png?w=590" alt=""></p>
<p>安裝 Easy Bootstrap ，選擇 Entware-ng OPKG 即可</p>
<hr>
<h5 id="synology-ds216j-optware-ipkg-介紹">Synology DS216j Optware IPKG 介紹</h5>
<p>與 <a href="http://jasmin.sakura.ne.jp/blog/0118">QNAP TS-219P+</a> 一樣，引入一個 Optware IPKG 作為軟件包管理工具。</p>
<p>DSM 自帶的軟件中心可以安裝需要東西 (比如Git/Subversin/Perl/PHP), 因為已經有了，但你也覺得沒有太大的必要，因為它可能會使用到的機會很少。</p>
<p><img src="https://f000.backblazeb2.com/file/viamoe/img/DS216j_0628_01.png" alt=""></p>
<h5 id="ssh-服務啟動">SSH 服務啟動</h5>
<p>在 <a href="http://jasmin.sakura.ne.jp/blog/0242">Synology DS216j 系統設置</a>中，請必須啟用 SSH 連接服務。</p>
<p>控制面板→終端機和SNMP</p>
<p><img src="https://f000.backblazeb2.com/file/viamoe/img/DS216j_0628_02.png" alt=""></p>
<ul>
<li>您可以變更加密模式的安全層級，請注意，安全层级不相容可能導致某些用戶端無法連線。</li>
</ul>
<h5 id="optware-ipkg-安裝">Optware IPKG 安裝</h5>
<p>不像 QNAP（現在當我看 QNAP 的 IPKG 已在維護，在後面將不再描述），因為它不能在系統軟件中心裡安裝，只能自己另外安裝。</p>
<p>安裝必須 與 DS216j 的 CPU 架構 （Marvell Armada 385 88F6820） 相符，可以在以下頁面找到這些信息。</p>
<p><a href="https://github.com/trepmag/ds213j-optware-bootstrap">GitHub - trepmag/ds213j-optware-bootstrap: Synology ds213j (manual) optware bootstrap</a></p>
<p>與 Marvell Armada 這個 CPU 相兼容的 optware-bootstrap 似乎不存在、不過與 Marvell Kirkwood 適配的 Marvell Kirkwoodのoptware-bootstrap 相兼容，可以共用。</p>
<p>也就是說,試試看吧。(上述頁面的內容完全相同。)</p>
<ol>
<li>用 SSH 進行客戶端連接。</li>
<li>先取得 root 權限。</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">sudo -i
</code></pre></div><ol start="3">
<li>創建用於存放 optware 的根目錄。</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">mkdir /volume1/@optware
mkdir /opt
mount -o bind /volume1/@optware /opt
</code></pre></div><ol start="4">
<li>設置 IPKG</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">feed<span style="color:#f92672">=</span>http://ipkg.nslu2-linux.org/feeds/optware/cs08q1armel/cross/unstable
ipk_name<span style="color:#f92672">=</span><span style="color:#e6db74">`</span>wget -qO- $feed/Packages | awk <span style="color:#e6db74">&#39;/^Filename: ipkg-opt/ {print $2}&#39;</span><span style="color:#e6db74">`</span>
wget $feed/$ipk_name
tar -xOvzf $ipk_name ./data.tar.gz | tar -C / -xzvf -
mkdir -p /opt/etc/ipkg
echo <span style="color:#e6db74">&#34;src cross </span>$feed<span style="color:#e6db74">&#34;</span> &gt; /opt/etc/ipkg/feeds.conf
</code></pre></div><ol start="5">
<li>設置 PATH：/etc/profile (用vi等編輯器)打開、在最後一行下面添加。</li>
</ol>
<pre><code>PATH=/opt/bin:/opt/sbin:$PATH
</code></pre><p>日文原文沒有提到 <code>source /etc/profile</code> ，如果不想重啟可以 source 一下。</p>
<ol start="6">
<li>設置初始化腳本，以便它重新啟動後生效。</li>
</ol>
<ul>
<li>以下內容寫入 <code>/etc/rc.local</code> 並設置文件的權限為 (chmod 755) 。</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#75715e">#!/bin/sh
</span><span style="color:#75715e"></span>
<span style="color:#75715e"># Optware setup</span>
<span style="color:#f92672">[</span> -x /etc/rc.optware <span style="color:#f92672">]</span> <span style="color:#f92672">&amp;&amp;</span> /etc/rc.optware start
</code></pre></div><ul>
<li>如果之前有共享的 <code>rc.local</code> 設置只要複製一下就可以了。</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#75715e">#將文件從 data 文件夾內複製</span>
cp /volume1/data/rc.local /etc/rc.local
chmod <span style="color:#ae81ff">755</span> /etc/rc.local
</code></pre></div><ul>
<li>以下內容寫入 <code>/etc/rc.optware</code> 並設置文件的權限為 (chmod 755) 。</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#75715e">#!/bin/sh
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">if</span> test -z <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>REAL_OPT_DIR<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>; <span style="color:#66d9ef">then</span>
<span style="color:#75715e"># next line to be replaced according to OPTWARE_TARGET</span>
REAL_OPT_DIR<span style="color:#f92672">=</span>/volume1/@optware
<span style="color:#66d9ef">fi</span>

<span style="color:#66d9ef">case</span> <span style="color:#e6db74">&#34;</span>$1<span style="color:#e6db74">&#34;</span> in
    start<span style="color:#f92672">)</span>
        echo <span style="color:#e6db74">&#34;Starting Optware.&#34;</span>
        <span style="color:#66d9ef">if</span> test -n <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>REAL_OPT_DIR<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>; <span style="color:#66d9ef">then</span>
            <span style="color:#66d9ef">if</span> ! grep <span style="color:#e6db74">&#39; /opt &#39;</span> /proc/mounts &gt;/dev/null 2&gt;&amp;<span style="color:#ae81ff">1</span> ; <span style="color:#66d9ef">then</span>
                mkdir -p /opt
                mount -o bind <span style="color:#e6db74">${</span>REAL_OPT_DIR<span style="color:#e6db74">}</span> /opt
            <span style="color:#66d9ef">fi</span>  
        <span style="color:#66d9ef">fi</span>
    <span style="color:#f92672">[</span> -x /opt/etc/rc.optware <span style="color:#f92672">]</span> <span style="color:#f92672">&amp;&amp;</span> /opt/etc/rc.optware
    ;;
    reconfig<span style="color:#f92672">)</span>
    true
    ;;
    stop<span style="color:#f92672">)</span>
        echo <span style="color:#e6db74">&#34;Shutting down Optware.&#34;</span>
    true
    ;;
    *<span style="color:#f92672">)</span>
        echo <span style="color:#e6db74">&#34;Usage: </span>$0<span style="color:#e6db74"> {start|stop|reconfig}&#34;</span>
        exit <span style="color:#ae81ff">1</span>
<span style="color:#66d9ef">esac</span>

exit <span style="color:#ae81ff">0</span>
</code></pre></div><ul>
<li>如果之前有共享的 <code>rc.optware</code> 設置只要複製一下就可以了。</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#75715e"># 將文件從 data 文件夾內複製</span>
cp /volume1/data/rc.optware /etc/rc.optware
chmod <span style="color:#ae81ff">755</span> /etc/rc.optware
</code></pre></div><ol start="7">
<li>IPKG 已經可以使用</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">ipkg -v
ipkg version 0.99.163
</code></pre></div><h5 id="optware-ipkg-版本太舊了">Optware IPKG 版本太舊了？</h5>
<p>Optware IPKG 在 QNAP一直沒有提供其他的版本，它似乎已經被 Entware 取代。 →<a href="http://qiita.com/efee/items/5da74eb7e7423e61823c">QNAP 4.1.4固件下 GCC 編譯安裝 - Qiita</a></p>
<p>而且，Entware-eg（Entware 的另一個版本？）也可以安裝到 Synology 的設備上。</p>
<p><a href="https://github.com/Entware-ng/Entware-ng/wiki/Install-on-Synology-NAS">Install on Synology NAS · Entware-ng/Entware-ng Wiki · GitHub</a></p>
<p>我已經使用 GCC 編譯安裝了 Entware-NG。您也可以嘗試一下。</p>
<hr>
<p>原文鏈接 <a href="http://jasmin.sakura.ne.jp/blog/0244">http://jasmin.sakura.ne.jp/blog/0244</a></p>
<p>看了這篇文章後我在自己的群暉 216J 上安裝了 <code>pip</code>，然後部署了一個 <a href="https://github.com/nicolargo/glances">glances</a> 用於監控我的 NAS 系統情況。</p>
<p>關於群暉上的一些 python 程序安裝可以看看這個 <a href="http://www.gebi1.com/thread-84122-1-1.html">http://www.gebi1.com/thread-84122-1-1.html</a></p>
</div>
  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://via.moe/tags/ipkg">ipkg</a></li>
      <li><a href="https://via.moe/tags/opkg">opkg</a></li>
    </ul>
  </footer>
  
</article></main>
<footer class="footer">
  <span>本博客除另外說明，都採用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh_TW">署名-非商業性使用-相同方式共享 4.0 協議</a> 進行許可<br>Except where otherwise noted, content on this site is licensed under a<br><a href="https://creativecommons.org/licenses/by-nc-sa/4.0/">Creative Commons Attribution-NonCommercial-ShareAlike 4.0</a> license</span>
</footer>
<script src="https://via.moe/highlight.min.js"></script>
<script>
  hljs.initHighlightingOnLoad();
</script>

<script async src="https://www.googletagmanager.com/gtag/js?id=UA-70500040-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-70500040-1');
</script>

</body>
</html>
